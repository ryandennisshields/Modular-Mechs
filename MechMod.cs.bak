using MechMod.Common.Players;
using MechMod.Content.Buffs;
using MechMod.Content.Items.MechLegs;
using MechMod.Content.Mounts;
using System;
using System.Collections.Generic;
using Terraria;
using Terraria.ID;
using Terraria.ModLoader;

namespace MechMod
{
    public struct MechPart
    {
        public int ItemType;
        public string PartType;

        public MechPart(int itemType, string partType)
        {
            ItemType = itemType;
            PartType = partType;
        }
    }

    public class MechMod : Mod
    {
        public static Dictionary<string, MechPart> MechParts;

        public override void Load()
        {
            MechParts = new Dictionary<string, MechPart>
            {
                { "BaseLegs", new MechPart(ModContent.ItemType<BaseLegs>(), "Legs")}
            };
        }
        public override void AddRecipes()
        {
            // recipes for parts here
        }

        public class EquipCommand : ModCommand
        {
            public override CommandType Type => CommandType.Chat;

            public override string Command => "equipPart";

            public override string Usage => "/equipPart <itemName>";

            public override string Description => "Equips the specified Part to the mech.";

            public override void Action(CommandCaller caller, string input, string[] args)
            {
                if (args.Length != 1)
                {
                    caller.Reply("Usage: /equipPart <itemName>");
                    return;
                }

                string partName = args[0];
                Player player = caller.Player;
                MechModPlayer mechPlayer = player.GetModPlayer<MechModPlayer>();

                if (MechMod.MechParts.TryGetValue(partName, out MechPart mechPart))
                {
                    Item item = new Item();
                    item.SetDefaults(mechPart.ItemType);

                    switch (mechPart.PartType)
                    {
                        case "Legs":
                            mechPlayer.equippedLegs = item;
                            
                            break;
                        case "Arms":
                            //modularMech.equippedArms = item;
                            //modularMech.ApplyArmsStats(player);
                            break;
                        case "Body":
                            //modularMech.equippedBody = item;
                            //modularMech.ApplyBodyStats(player);
                            break;
                    }
                    caller.Reply($"Equipped {partName} to the mech.");
                }
                else
                {
                    caller.Reply($"Part {partName} not found.");
                }
            }
        }

        public class UnequipCommand : ModCommand
        {
            public override CommandType Type => CommandType.Chat;

            public override string Command => "unequipPart";

            public override string Usage => "/unequipPart <partslotName>";

            public override string Description => "Unequips the Part equipped to the specified slot of the mech.";

            public override void Action(CommandCaller caller, string input, string[] args)
            {
                if (args.Length != 1)
                {
                    caller.Reply("Usage: /unequipPart <partslotName>");
                    return;
                }

                string partslotName = args[0];
                Player player = caller.Player;
                MechModPlayer mechPlayer = player.GetModPlayer<MechModPlayer>();

                switch (partslotName)
                {
                    case "Legs":
                        mechPlayer.equippedLegs = null;
                        caller.Reply($"Unequipped Legs from the mech.");
                        break;
                    case "Arms":
                        //modularMech.equippedArms = item;
                        //modularMech.ApplyArmsStats(player);
                        caller.Reply($"Unequipped Arms from the mech.");
                        break;
                    case "Body":
                        //modularMech.equippedBody = item;
                        //modularMech.ApplyBodyStats(player);
                        caller.Reply($"Unequipped Body from the mech.");
                        break;
                    default:
                        caller.Reply($"Slot {partslotName} not recognized.");
                        break;
                }
            }
        }

        public override void PostSetupContent()
        {
            int mechDebuff = ModContent.BuffType<MechDebuff>();
            Terraria.ID.BuffID.Sets.NurseCannotRemoveDebuff[mechDebuff] = true;
        }
    }
}